// This is your Prisma schema file for PostgreSQL (use this for Railway with PostgreSQL)
// Rename this to schema.prisma when using PostgreSQL

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String
  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)
}

model MarketingCost {
  id          String   @id @default(uuid())
  shop        String
  platform    String   // "facebook", "google", "tiktok", "influencer", "manual"
  amount      Float
  date        DateTime
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([shop, platform, date], name: "shop_platform_date")
}

model FixedCost {
  id          String   @id @default(uuid())
  shop        String
  category    String   // "rent", "salary", "software", "other"
  name        String
  amount      Float
  startDate   DateTime
  endDate     DateTime?
  recurring   Boolean  @default(true) // monthly recurring or one-time
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ManualCost {
  id          String   @id @default(uuid())
  shop        String
  category    String   // "shipping", "cogs", "other"
  description String
  amount      Float
  date        DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Integration {
  id          String   @id @default(uuid())
  shop        String
  platform    String   // "quickbooks", "facebook_ads", "google_ads", "tiktok_ads"
  isActive    Boolean  @default(false)
  credentials String?  @db.Text // Use Text for PostgreSQL to store long JSON strings
  lastSync    DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([shop, platform], name: "shop_platform")
}

model Settings {
  id                    String   @id @default(uuid())
  shop                  String   @unique
  transactionFeePercent Float    @default(3.0)
  currency              String   @default("USD")
  monthlyTarget         Float?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}

model MetricTargets {
  id                    String   @id @default(uuid())
  shop                  String   @unique
  grossProfit           Float?
  contributionProfit    Float?
  netProfit             Float?
  totalSales            Float?
  newCustomerRevenue    Float?
  returnCustomerRevenue Float?
  variableCosts         Float?
  marketingCosts        Float?
  fixedCosts            Float?
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
}
